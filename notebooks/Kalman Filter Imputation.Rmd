---
title: "Kalman Filter Imputation"
output:
  html_document:
    theme: flatly
    toc: true
    toc_float: true
    number_sections: true
---

# Import Data

```{r}
library(imputeTS)
library(dplyr)
```

Data yang digunakan merupakan data traffic di Thamrin yang bersumber dari Mendeley: https://data.mendeley.com/datasets/nf3gds4zk9/2

```{r}
df <- read.csv("Data MPDW Kelompok 1.csv")
head(df)
nrow(df)
```

Terdapat **8760 amatan**.

# Imputasi NA menjadi Nol

```{r}
df$Out_Total[is.na(df$Out_Total)] <- 0
df$In_Total[is.na(df$In_Total)] <- 0
```

# Melihat data nol selain CFD

Car Free Day dilaksanakan setiap hari Minggu pukul 06.00 – 10.00 pagi, sehingga akan dilihat nilai nol selain di waktu Car Free Day.

## Out_Total
```{r}
df_zero_nonCFD_Out <- df[
  df$Out_Total == 0 & !(df$Day == 6 & df$Hour %in% 6:9),
]

head(df_zero_nonCFD_Out)
nrow(df_zero_nonCFD_Out)
```
Terdapat **76 missing value** pada variabel *Out_Total* untuk baris **selain hari Minggu pada pukul 06.00–10.00 pagi**.

## In_Total

```{r}
df_zero_nonCFD_In <- df[
  df$In_Total == 0 & !(df$Day == 6 & df$Hour %in% 6:9),
]

head(df_zero_nonCFD_In)
nrow(df_zero_nonCFD_In)
```

Terdapat **412 missing value** pada variabel *In_Total* untuk baris **selain hari Minggu pada pukul 06.00–10.00 pagi**.

# Imputasi dengan Kalman Filter

## Out_Total

```{r}
df <- df %>%
  mutate(
    Out_Total_adj = ifelse(Out_Total == 0 & !(Day == 6 & Hour %in% 6:9),
                           NA, Out_Total)
  )

# imputasi hanya pada NA
df <- df %>%
  mutate(
    Out_Total_imputed = na_kalman(Out_Total_adj)
  )
```

## In_Total
```{r}
df <- df %>%
  mutate(
    In_Total_adj = ifelse(In_Total == 0 & !(Day == 6 & Hour %in% 6:9),
                           NA, In_Total)
  )

df <- df %>%
  mutate(
    In_Total_imputed = na_kalman(In_Total_adj)
  )
```

# Lihat hasil Imputasi

## Out_Total

```{r}
df_changed_out <- df %>%
  filter(Out_Total != Out_Total_imputed) %>%
  select(Out_Total, Out_Total_imputed, Month, Date, Day, Hour)

head(df_changed_out)
```

## In_Total

```{r}
df_changed_in <- df %>%
  filter(In_Total != In_Total_imputed) %>%
  select(In_Total, In_Total_imputed, Month, Date, Day, Hour)

head(df_changed_in)
```

# Visualisasi dengan Line Chart

```{r}
index <- c(1:nrow(df))
length(index)
```

## Out_Total

```{r}
plot(index, df$Out_Total_imputed, type = "l", col = "blue", lwd = 0.05,
     main = "Out_Total setelah imputasi",
     xlab = "Index",
     ylab = "Nilai")
```

## In_Total

```{r}
plot(index, df$In_Total_imputed, type = "l", col = "blue", lwd = 0.05,
     main = "In_Total setelah imputasi",
     xlab = "Index",
     ylab = "Nilai")
```

# Simpan Data yang telah diimputasi

```{r}
df <- df %>%
  select(Date_and_Time, In_Total_imputed, Out_Total_imputed, Date, Hour, Weekend, Public_Holiday)

head(df)
```

```{r}
write.csv(df, "Data MPDW Kelompok 1 (Imputed).csv", row.names = FALSE)
```








